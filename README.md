# Bilibili Discord Audio Bot

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„ Discord æœºå™¨äººï¼Œæ”¯æŒä» Bilibili è§†é¢‘æ’­æ”¾éŸ³é¢‘ï¼Œå…·æœ‰ä¸°å¯Œçš„å¯è§†åŒ–ç•Œé¢å’Œäº¤äº’å¼æ§åˆ¶åŠŸèƒ½ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œä»£ç ç»„ç»‡æ¸…æ™°ï¼š

- `src/` - æºä»£ç ï¼ˆæŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡ï¼‰
- `tests/` - å®Œæ•´æµ‹è¯•å¥—ä»¶
- `docs/` - é¡¹ç›®æ–‡æ¡£
- `setup/` - å¿«é€Ÿå¼€å§‹é…ç½®
- `scripts/` - è‡ªåŠ¨åŒ–è„šæœ¬
- `config/` - é…ç½®æ–‡ä»¶

è¯¦ç»†ç»“æ„è¯´æ˜è¯·æŸ¥çœ‹ [PROJECT_STRUCTURE.md](docs/PROJECT_STRUCTURE.md)

## ğŸš€ å¼€å‘è¿›åº¦

- âœ… **é¡¹ç›®æ¶æ„** - å®Œæ•´çš„æ¨¡å—åŒ–æ¶æ„è®¾è®¡
- âœ… **æµ‹è¯•æ¡†æ¶** - å…¨é¢çš„éŸ³é¢‘å’Œ UI æµ‹è¯•å¥—ä»¶
- âœ… **URL éªŒè¯** - Bilibili URL è§£æå’ŒéªŒè¯ (100% æµ‹è¯•é€šè¿‡)
- âœ… **éŸ³é¢‘æå–** - å®Œæ•´çš„ Bilibili è§†é¢‘éŸ³é¢‘æå–åŠŸèƒ½ (100% æµ‹è¯•é€šè¿‡)
- âœ… **Discord é›†æˆ** - æ–œæ å‘½ä»¤å’Œäº¤äº’å¼ UI (100% æµ‹è¯•é€šè¿‡)
- âœ… **å¯è§†åŒ–ç•Œé¢** - Rich Embeds å’Œäº¤äº’å¼æŒ‰é’®
- ğŸ”„ **éŸ³é¢‘æ’­æ”¾** - è¿›è¡Œä¸­
- â³ **é”™è¯¯å¤„ç†** - å¾…å®ç°

## ğŸ§ª æµ‹è¯•çŠ¶æ€

### å®Œæˆçš„æµ‹è¯•å¥—ä»¶

```bash
# éŸ³é¢‘åŠŸèƒ½æµ‹è¯• (97% æˆåŠŸç‡)
npm run test:audio

# éŸ³é¢‘æå–å™¨æµ‹è¯• (100% æˆåŠŸç‡)
npm run test:extractor

# Discordé›†æˆæµ‹è¯• (100% æˆåŠŸç‡)
npm run test:discord
```

### æµ‹è¯•ç»“æœæ€»è§ˆ

- **éŸ³é¢‘éªŒè¯**: 37/38 tests (97% æˆåŠŸç‡)
- **éŸ³é¢‘æå–**: 11/11 tests (100% æˆåŠŸç‡)
- **Discord é›†æˆ**: 16/16 tests (100% æˆåŠŸç‡)

## ğŸ¯ å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½

### ğŸµ éŸ³é¢‘æå–ç³»ç»Ÿ

- **URL æ”¯æŒ**: æ‰€æœ‰ Bilibili æ ¼å¼ (BV*, av*, b23.tv, ç§»åŠ¨ç«¯)
- **å…ƒæ•°æ®æå–**: æ ‡é¢˜ã€æ—¶é•¿ã€ä¸Šä¼ è€…ã€ç¼©ç•¥å›¾
- **éŸ³é¢‘æµè·å–**: é«˜è´¨é‡éŸ³é¢‘æµ URL æå–
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ¢å¤æœºåˆ¶

### ğŸ¤– Discord é›†æˆ

- **æ–œæ å‘½ä»¤**: 7 ä¸ªå®Œæ•´å®ç°çš„å‘½ä»¤
  - `/play [url]` - æ’­æ”¾ Bilibili è§†é¢‘éŸ³é¢‘
  - `/pause` - æš‚åœæ’­æ”¾
  - `/resume` - æ¢å¤æ’­æ”¾
  - `/skip` - è·³åˆ°ä¸‹ä¸€é¦–
  - `/prev` - è¿”å›ä¸Šä¸€é¦–
  - `/queue` - æ˜¾ç¤ºæ’­æ”¾é˜Ÿåˆ—
  - `/nowplaying` - æ˜¾ç¤ºå½“å‰æ’­æ”¾ä¿¡æ¯

### ğŸ¨ å¯è§†åŒ–ç•Œé¢

- **Rich Embeds**: ç²¾ç¾çš„åµŒå…¥æ¶ˆæ¯æ˜¾ç¤º
- **å®æ—¶è¿›åº¦æ¡**: `â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘ 50% | 2:34 / 5:12`
- **äº¤äº’å¼æŒ‰é’®**: â®ï¸ â¸ï¸ â­ï¸ ğŸ“‹
- **å½©è‰²çŠ¶æ€æŒ‡ç¤º**: ç»¿è‰²=æ’­æ”¾ï¼Œé»„è‰²=åŠ è½½ï¼Œçº¢è‰²=é”™è¯¯

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ bot/               # Discordæœºå™¨äººå®ç°
â”‚   â”œâ”€â”€ client.js      # å®¢æˆ·ç«¯ç®¡ç†
â”‚   â””â”€â”€ commands/      # æ–œæ å‘½ä»¤
â”œâ”€â”€ audio/             # éŸ³é¢‘æå–å’Œå¤„ç†
â”‚   â””â”€â”€ extractor.js   # BilibiliéŸ³é¢‘æå–å™¨
â”œâ”€â”€ ui/                # å¯è§†åŒ–ç•Œé¢ç»„ä»¶
â”‚   â”œâ”€â”€ embeds.js      # Rich embedç”Ÿæˆå™¨
â”‚   â””â”€â”€ buttons.js     # äº¤äº’å¼æŒ‰é’®
â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â””â”€â”€ config/            # é…ç½®ç®¡ç†

tests/
â”œâ”€â”€ manual/            # æ‰‹åŠ¨æµ‹è¯•è„šæœ¬
â””â”€â”€ setup.js           # Jestæµ‹è¯•é…ç½®

scripts/
â””â”€â”€ deploy-commands.js # å‘½ä»¤éƒ¨ç½²è„šæœ¬
```

## ğŸ›  å®‰è£…å’Œé…ç½®

### å‰ç½®è¦æ±‚

- Node.js 18.x+
- Python 3.8+ (ç”¨äº yt-dlp)
- yt-dlp (`pip install yt-dlp`)

### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd bilibili-discord-bot

# 2. å®‰è£…ä¾èµ–
npm install
pip install yt-dlp

# 3. é…ç½®ç¯å¢ƒ
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„Discord Bot Token

# 4. éƒ¨ç½²å‘½ä»¤åˆ°Discord
npm run deploy:commands

# 5. å¯åŠ¨æœºå™¨äºº
npm start
```

### ç¯å¢ƒå˜é‡é…ç½®

```env
# Discordé…ç½®
DISCORD_TOKEN=your_discord_bot_token_here
CLIENT_ID=your_discord_application_id_here
GUILD_ID=your_test_guild_id_here

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
NODE_ENV=production
```

## ğŸ¯ å½“å‰å¯ç”¨åŠŸèƒ½

### URL æ”¯æŒ

- `https://www.bilibili.com/video/BV*`
- `https://www.bilibili.com/video/av*`
- `https://b23.tv/*` (çŸ­é“¾æ¥)
- `https://m.bilibili.com/video/*` (ç§»åŠ¨ç«¯)
- æ”¯æŒå¸¦å‚æ•°çš„ URL (å¦‚ `?p=2`, `?t=120`)

### å‘½ä»¤æ¼”ç¤º

```bash
# åŸºç¡€æ’­æ”¾
/play url:https://www.bilibili.com/video/BV1uv4y1q7Mv

# é˜Ÿåˆ—ç®¡ç†
/queue          # æ˜¾ç¤ºå½“å‰é˜Ÿåˆ—
/skip           # è·³åˆ°ä¸‹ä¸€é¦–
/prev           # è¿”å›ä¸Šä¸€é¦–

# æ’­æ”¾æ§åˆ¶
/pause          # æš‚åœæ’­æ”¾
/resume         # æ¢å¤æ’­æ”¾
/nowplaying     # æ˜¾ç¤ºå½“å‰æ’­æ”¾ä¿¡æ¯
```

## ğŸ§ª å¼€å‘å’Œæµ‹è¯•

### æµ‹è¯•å‘½ä»¤

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm test

# ç‰¹å®šåŠŸèƒ½æµ‹è¯•
npm run test:audio      # éŸ³é¢‘åŠŸèƒ½æµ‹è¯•
npm run test:extractor  # éŸ³é¢‘æå–æµ‹è¯•
npm run test:discord    # Discordé›†æˆæµ‹è¯•
npm run test:player     # éŸ³é¢‘æ’­æ”¾å™¨æµ‹è¯•
npm run test:system     # å®Œæ•´ç³»ç»Ÿæµ‹è¯•

# æµ‹è¯•ç‰¹å®šURL
node tests/manual/audio-test.js "https://www.bilibili.com/video/BV1234567890"
```

### å¼€å‘å‘½ä»¤

```bash
npm run dev             # å¼€å‘æ¨¡å¼ (nodemon)
npm run lint            # ä»£ç æ£€æŸ¥
npm run lint:fix        # è‡ªåŠ¨ä¿®å¤ä»£ç æ ¼å¼
```

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

- **URL éªŒè¯**: 100% æˆåŠŸç‡
- **éŸ³é¢‘æå–**: 100% æˆåŠŸç‡ (SSL ä¿®å¤å)
- **Discord é›†æˆ**: 100% æµ‹è¯•é€šè¿‡
- **å“åº”æ—¶é—´**: éŸ³é¢‘æå– < 15 ç§’
- **æ”¯æŒæ ¼å¼**: æ‰€æœ‰ä¸»æµ Bilibili URL æ ¼å¼

## ğŸ”„ é¡¹ç›®å®ŒæˆçŠ¶æ€

âœ… **æ ¸å¿ƒåŠŸèƒ½**: 100% å®Œæˆ

- Bilibili è§†é¢‘éŸ³é¢‘æå–
- Discord æ–œæ å‘½ä»¤ç³»ç»Ÿ
- å¯è§†åŒ–ç•Œé¢å’Œäº¤äº’å¼æ§åˆ¶
- éŸ³é¢‘æ’­æ”¾å’Œé˜Ÿåˆ—ç®¡ç†
- å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶

ğŸ”§ **å¯é€‰å¢å¼ºåŠŸèƒ½**:

1. **FFmpeg ä¾èµ–**: å®‰è£…ä»¥å¯ç”¨å®é™…éŸ³é¢‘æ’­æ”¾
2. **æ€§èƒ½ä¼˜åŒ–**: ç¼“å­˜å’Œè¿æ¥æ± ç®¡ç†
3. **é«˜çº§åŠŸèƒ½**: æ’­æ”¾åˆ—è¡¨ã€æ­Œè¯æ˜¾ç¤ºç­‰
4. **éƒ¨ç½²ä¼˜åŒ–**: Docker å®¹å™¨åŒ–ã€CI/CD

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issues å’Œ Pull Requests æ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

**ç‰ˆæœ¬**: 1.0.0-dev  
**æœ€åæ›´æ–°**: 2025 å¹´ 9 æœˆ 1 æ—¥  
**æµ‹è¯•è¦†ç›–ç‡**: 97%+ (æ€»ä½“)
